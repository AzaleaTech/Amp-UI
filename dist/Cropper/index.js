"use strict";Component({properties:{imgUrl:{type:String,value:""},type:{type:String,value:"extra"},cutScale:{type:Number,value:1}},data:{screenWidth:"",width:"",height:"",distance:"",oldWidth:"",oldHeight:"",cutWidth:"",x:0,y:0,croppedPic:"",oldImagePath:""},lifetimes:{attached:function(){var e=this;wx.getSystemInfo({success:function(t){t=t.screenWidth-60*t.screenWidth/750;e.setData({screenWidth:t,cutWidth:t}),e.setImage()}})}},observers:{imgUrl:function(){this.data.oldImagePath=this.properties.imgUrl}},methods:{setImage:function(){var e=this,a=this.data.screenWidth,i=this.data.screenWidth/this.properties.cutScale,h=this.data.oldImagePath;wx.getImageInfo({src:h,success:function(t){t=t.width/t.height;t>e.properties.cutScale?e.setData({width:i*t,height:i,oldWidth:i*t,oldHeight:i,img:h}):e.setData({width:a,height:a/t,oldWidth:a,oldHeight:a/t,img:h})}})},handleResetImage:function(){this.setData({croppedPic:""}),this.setImage()},handleStart:function(t){var e;2===t.touches.length&&(e=t.touches[1].pageX-t.touches[0].pageX,t=t.touches[1].pageY-t.touches[0].pageY,t=Math.sqrt(Math.pow(e,2)+Math.pow(t,2)),this.setData({distance:t}))},handleMove:function(t){var e,a,i,h,s;2===t.touches.length&&(h=t.touches[1].pageX-t.touches[0].pageX,s=t.touches[1].pageY-t.touches[0].pageY,e=this.data.oldWidth,a=this.data.oldHeight,i=Math.sqrt(Math.pow(h,2)+Math.pow(s,2)),t=this.data.width,h=this.data.height,t*(s=1+.002*(i-this.data.distance))/e<1?this.setData({width:e,height:a}):this.setData({width:t*s,height:h*s,distance:i}))},handleScroll:function(t){var e=t.detail.scrollLeft,t=t.detail.scrollTop;this.setData({x:e,y:t})},handleCrop:function(){var e=this,t=this.properties.imgUrl,a=this.data.width,i=this.data.height,h=this.data.screenWidth,s=this.data.x,c=this.data.y;wx.showLoading({title:"裁剪中"});var d=wx.createCanvasContext("canvas",this);d.drawImage(t,0,0,a,i),d.draw(setTimeout(function(){wx.hideLoading(),wx.canvasToTempFilePath({x:s,y:c,width:h,height:h/e.properties.cutScale,canvasId:"canvas",success:function(t){e.setData({croppedPic:t.tempFilePath})}},e)},1e3))},handleSave:function(){var a=this;[this.data.croppedPic].forEach(function(t){var e=t.substr(t.lastIndexOf(".")+1),e="".concat(a.properties.type,"/").concat((new Date).valueOf()).concat(Math.random().toString(36).slice(-6),".").concat(e);a.triggerEvent("save",{item:t,fileName:e})})},handleCancel:function(){this.triggerEvent("cancel")}}});