"use strict";var recorderManager=wx.getRecorderManager(),innerAudioContext=wx.createInnerAudioContext();Component({properties:{tips:{type:String,value:"长按录入详细信息"}},data:{recordIcon:0,playIcon:0,time:null,recordManager:null,filePath:"",canRecord:!1,isRecording:!1,show:!0,isPlaying:!1},lifetimes:{attached:function(){wx.setInnerAudioOption({obeyMuteSwitch:!1})},ready:function(){var a=this;wx.authorize({scope:"scope.record",success:function(){a.data.canRecord=!0},fail:function(){wx.showModal({title:"提示",content:"您未授权录音，功能将无法使用",showCancel:!0,confirmText:"授权",success:function(t){t.confirm?wx.openSetting({success:function(t){t.authSetting["scope.record"]?a.data.canRecord=!0:wx.showModal({title:"提示",content:"您未授权录音，功能将无法使用",showCancel:!1})}}):a.data.canRecord=!1}})}})},detached:function(){clearInterval(this.data.time),innerAudioContext.stop(),recorderManager.stop()}},methods:{recording:function(){var t=this;this.data.time=setInterval(function(){t.setData({recordIcon:2===t.data.recordIcon?0:t.data.recordIcon+1})},400)},handleLongPress:function(){var a=this;this.data.canRecord?this.data.isRecording||this.data.filePath||(this.setData({isRecording:!0}),this.setData({show:!0},function(){a.recording(),recorderManager.start({format:"mp3"})})):wx.openSetting({success:function(t){t.authSetting["scope.record"]?a.data.canRecord=!0:wx.showModal({title:"提示",content:"您未授权录音，功能将无法使用",showCancel:!1})}})},cancelTouch:function(){var a=this;this.data.isRecording&&!this.data.filePath&&(this.setData({isRecording:!1}),clearInterval(this.data.time),this.data.time=null,recorderManager.stop(),recorderManager.onStop(function(t){a.data.filePath=t.tempFilePath,innerAudioContext.src=a.data.filePath,a.setData({filePath:a.data.filePath,recordIcon:0}),a.triggerEvent("change",{value:a.data.filePath})}))},handleRecord:function(){var a=this;this.data.canRecord?this.data.filePath&&(this.data.time?(innerAudioContext.stop(),clearInterval(this.data.time),this.data.time=null,this.setData({playIcon:0,isPlaying:!1})):(innerAudioContext.play(),innerAudioContext.onEnded(function(){clearInterval(a.data.time),a.data.time=null,a.setData({playIcon:0,isPlaying:!1})}),this.playVoice(),this.setData({isPlaying:!0}))):wx.openSetting({success:function(t){t.authSetting["scope.record"]?a.data.canRecord=!0:wx.showModal({title:"提示",content:"您未授权录音，功能将无法使用",showCancel:!1})}})},playVoice:function(){var t=this;this.data.time=setInterval(function(){t.setData({playIcon:2===t.data.playIcon?0:t.data.playIcon+1})},400)},handleDelete:function(){innerAudioContext.stop(),clearInterval(this.data.time),this.data.time=null,this.setData({filePath:"",playIcon:0}),this.triggerEvent("change",{value:this.data.filePath})}}});